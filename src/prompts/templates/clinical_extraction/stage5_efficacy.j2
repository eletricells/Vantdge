Extract efficacy endpoints for {{ arm_name }}.

{% include 'clinical_extraction/_partials/event_rate_warning.j2' %}

TABLES: {{ tables | join(', ') }}
{% if standard_endpoints %}

STANDARD CLINICAL ENDPOINTS FOR {{ indication }}:
{% for ep in standard_endpoints %}
- {{ ep }}
{% endfor %}
{% endif %}

EFFICACY TABLES:
{{ table_content }}

INSTRUCTIONS:

ğŸš¨ CRITICAL INSTRUCTION #1 - EVENT RATE DATA vs RESPONDER DATA:
âš ï¸ MOST COMMON ERROR: Putting event counts in responders_n field!

ASK YOURSELF: Is this endpoint measuring:
A) % of patients who achieved something? â†’ Use responders_n, responders_pct
B) Rate of events per patient-year? â†’ Use mean_value/median_value, endpoint_unit

Examples:
- "50% achieved remission" â†’ RESPONDER DATA â†’ responders_n, responders_pct
- "1.7 flares per patient-year (51 events)" â†’ EVENT RATE DATA â†’ mean_value: 1.7, endpoint_unit: "events per patient-year"
  âš ï¸ Use the RATE (1.7), NOT the event count (51)!

IF THE ENDPOINT NAME CONTAINS: "Flares", "Infections", "Events", "Exacerbations", "per patient-year"
â†’ This is almost always EVENT RATE DATA, NOT responder data!
â†’ Extract the RATE value â†’ put in mean_value or median_value
â†’ IGNORE event counts â†’ do NOT put in responders_n!

ğŸš¨ CRITICAL INSTRUCTION #2 - PREVENTING VALUE FABRICATION:
- ONLY extract values that are EXPLICITLY STATED in text or table cells
- If a value appears only in a figure/graph without accompanying text, set the field to NULL
- DO NOT estimate, interpolate, read from bar charts, or guess any values
- DO NOT extract values from figure legends unless they contain exact numbers in text
- If you cannot find an exact numerical value stated in text or a table, return NULL for that field
- When in doubt, return NULL rather than risk fabrication

Example: If Figure 1 shows a bar chart with SRI-4 response rates but no text values are provided,
return NULL for responders_pct. Do NOT try to estimate the percentage from the visual height of bars.

Example: If text says "SRI-4 response rates are shown in Figure 2" but Figure 2 has no extractable text,
return NULL for responders_pct. Do NOT guess the value.

1. Extract ALL efficacy endpoints at ALL timepoints (but ONLY if values are explicitly stated)
2. For each endpoint, extract:
   - endpoint_name (CLEAN NAME - remove analysis type qualifiers like "(ITT)", "(PP)", "(ITT population)", etc.)
   - is_standard_endpoint (true if matches standard endpoints above)
   - timepoint (e.g., "Week 16")
   - timepoint_weeks (INTEGER - convert to weeks for sorting, e.g., "Week 2" â†’ 2, "Week 24" â†’ 24)
   - analysis_type (EXTRACT SEPARATELY - "ITT", "PP", "Safety", "Per-protocol", "Intent-to-treat", etc.)
   - Data values (IMPORTANT - see field usage below, NULL if not explicitly stated)
   - endpoint_unit (CRITICAL - extract units for ALL continuous values)
   - p_value, stat_sig
   - source_table

3. Match to standard endpoints when possible (fuzzy matching OK)

CRITICAL DEDUPLICATION RULES:
- "24-hour UPCR (ITT population)" â†’ endpoint_name: "24-hour UPCR", analysis_type: "ITT"
- "24-hour UPCR (PP)" â†’ endpoint_name: "24-hour UPCR", analysis_type: "PP"
- "Mean eGFR - ITT" â†’ endpoint_name: "Mean eGFR", analysis_type: "ITT"
- Remove ALL analysis population qualifiers from endpoint_name!

CRITICAL: ALWAYS extract endpoint_unit for continuous outcomes!
- If paper says "Mean eGFR 102.4 ml/min per 1.73 mÂ²", extract: mean_value: 102.4, endpoint_unit: "ml/min per 1.73 mÂ²"
- If paper says "Change in UPCR -2.0 mg/mg", extract: change_from_baseline_mean: -2.0, endpoint_unit: "mg/mg"
- If paper says "Percent change +50%", extract: pct_change_from_baseline: 50 (NO unit needed for percent)

ğŸš¨ğŸš¨ğŸš¨ CRITICAL: FIELD USAGE FOR DATA VALUES ğŸš¨ğŸš¨ğŸš¨

RULE 1: Binary/Categorical Outcomes (% achieving endpoint)
â†’ Use responders_n and responders_pct
Example: "6/8 patients achieved response"
â†’ responders_n: 6, n_evaluated: 8, responders_pct: 75.0

RULE 2: Continuous Outcomes - ABSOLUTE VALUES
â†’ Use mean_value OR median_value (NUMBER ONLY) + endpoint_unit (UNIT ONLY)
Examples:
  "Mean eGFR 102.4 ml/min" â†’ mean_value: 102.4, endpoint_unit: "ml/min per 1.73 mÂ²"
  "Median eGFR 98.5 ml/min" â†’ median_value: 98.5, endpoint_unit: "ml/min per 1.73 mÂ²"

RULE 3: Continuous Outcomes - PERCENT CHANGE
â†’ Use pct_change_from_baseline (NUMBER ONLY, no % sign)
Example: "Mean change -50.9%" â†’ pct_change_from_baseline: -50.9

RULE 4: Continuous Outcomes - ABSOLUTE CHANGE
â†’ Use change_from_baseline_mean OR change_from_baseline (NUMBER ONLY) + endpoint_unit
Examples:
  "Mean change -2.0 mg/mg" â†’ change_from_baseline_mean: -2.0, endpoint_unit: "mg/mg"
  "Median change -1.8 mg/mg" â†’ change_from_baseline: -1.8, endpoint_unit: "mg/mg"

ğŸš¨ğŸš¨ğŸš¨ RULE 5: EVENT RATE DATA (CRITICAL - MOST COMMON ERROR!) ğŸš¨ğŸš¨ğŸš¨

EVENT RATES measure EVENTS (not responders)!
Examples: "Flares", "Infections", "Exacerbations", "Adverse Events per patient-year"

âš ï¸ IF endpoint measures EVENT RATES (not % of patients achieving something):
â†’ Extract the RATE value (e.g., 1.7) â†’ put in mean_value OR median_value
â†’ Extract the unit (e.g., "events per patient-year") â†’ put in endpoint_unit
â†’ IGNORE event counts (e.g., "51 events") - these are NOT responder counts!
â†’ Set responders_n = NULL (event counts are NOT patient counts!)
â†’ Set responders_pct = NULL
â†’ Set n_evaluated = number of patients in the analysis

Example from Figure: "Overall Flares: 1.7 per patient-year (51 events/PY)"

CORRECT âœ“:
{
  "endpoint_name": "Overall Flares",
  "timepoint": "Week 48",
  "mean_value": 1.7,
  "endpoint_unit": "events per patient-year",
  "responders_n": null,
  "responders_pct": null,
  "n_evaluated": 68
}

WRONG âœ— (DO NOT DO THIS):
{
  "endpoint_name": "Overall Flares",
  "responders_n": 51,
  "mean_value": null
}

âš ï¸ KEY DISTINCTION:
- "50% of patients achieved remission" â†’ responders_n: 34, responders_pct: 50 (RESPONDER DATA)
- "1.7 flares per patient-year (51 events)" â†’ mean_value: 1.7, endpoint_unit: "events per patient-year" (EVENT RATE DATA - ignore the 51!)

DO NOT include units, SD, or annotations in numeric fields!
WRONG: mean_value: "3.3 g/dl (SD 0.7)" âœ—
RIGHT: mean_value: 3.3, endpoint_unit: "g/dl" âœ“

OUTPUT FORMAT:
{
  "endpoints": [
    {
      "endpoint_category": "Primary",
      "endpoint_name": "EASI-75",
      "endpoint_unit": null,
      "is_standard_endpoint": true,
      "timepoint": "Week 16",
      "timepoint_weeks": 16,
      "analysis_type": "ITT",
      "responders_pct": 48.0,
      "stat_sig": true,
      "p_value": "p<0.001",
      "source_table": "Table 3"
    }
  ]
}

{% include 'common/json_output_rules.j2' %}

